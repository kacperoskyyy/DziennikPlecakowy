<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DziennikPlecakowy.ViewModels"
             x:DataType="vm:EditAccountViewModel"
             x:Class="DziennikPlecakowy.Views.EditAccountPage"
             Shell.NavBarIsVisible="False">

    <ScrollView>
        <VerticalStackLayout Padding="0,20,0,20" Spacing="10" IsEnabled="{Binding IsNotBusy}">

            <Label Text="Edytuj Konto" Style="{StaticResource TitleLabel}" />
            <ActivityIndicator IsRunning="{Binding IsBusy}" />

            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Zmień nazwę użytkownika" Style="{StaticResource CardTitleLabel}" />

                    <Entry Placeholder="Nowa nazwa" 
                           Text="{Binding NewUsername}" 
                           Style="{StaticResource MainEntry}" 
                           MaxLength="30" />

                    <Label Text="{Binding UsernameMessage}" 
                           Style="{StaticResource LabelError}"
                           IsVisible="{Binding UsernameMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}" />
                    <Button Text="Zapisz nazwę" 
                            Command="{Binding ChangeUsernameCommand}" 
                            Style="{StaticResource MainButton}" />
                </VerticalStackLayout>
            </Frame>

            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout Spacing="5">
                    <Label Text="Zmień hasło" Style="{StaticResource CardTitleLabel}" />

                    <Entry Placeholder="Bieżące hasło" 
                           Text="{Binding CurrentPassword}" 
                           IsPassword="True" 
                           Style="{StaticResource MainEntry}" 
                           MaxLength="50" />

                    <Entry Placeholder="Nowe hasło" 
                           Text="{Binding NewPassword}" 
                           IsPassword="True" 
                           Style="{StaticResource MainEntry}" 
                           MaxLength="50" />

                    <Entry Placeholder="Potwierdź nowe hasło" 
                           Text="{Binding ConfirmNewPassword}" 
                           IsPassword="True" 
                           Style="{StaticResource MainEntry}" 
                           MaxLength="50" />

                    <Label Text="{Binding PasswordMessage}" 
                           Style="{StaticResource LabelError}"
                           IsVisible="{Binding PasswordMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}" />
                    <Button Text="Zapisz hasło" 
                            Command="{Binding ChangePasswordCommand}" 
                            Style="{StaticResource MainButton}" />
                </VerticalStackLayout>
            </Frame>

            <Frame Style="{StaticResource CardFrame}">
                <VerticalStackLayout>
                    <Button Text="Usuń konto" 
                            Command="{Binding DeleteAccountCommand}" 
                            Style="{StaticResource DeleteButton}" />
                    <Label Text="{Binding DeleteMessage}" 
                           Style="{StaticResource LabelError}"
                           IsVisible="{Binding DeleteMessage, Converter={StaticResource IsNotNullOrEmptyConverter}}" />
                </VerticalStackLayout>
            </Frame>

            <Button Text="Wróć" 
                    Command="{Binding GoBackCommand}" 
                    Style="{StaticResource TextButton}" />

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>