<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DziennikPlecakowy.ViewModels"
             xmlns:dto="clr-namespace:DziennikPlecakowy.DTO"
             xmlns:maps="clr-namespace:Microsoft.Maui.Controls.Maps;assembly=Microsoft.Maui.Controls.Maps"
             x:DataType="vm:TripDetailViewModel"
             x:Class="DziennikPlecakowy.Views.TripDetailPage"
             Title="{Binding Title}">

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="10">
            <ActivityIndicator IsRunning="{Binding IsBusy}" HorizontalOptions="Center" />

            <ContentView Content="{Binding TripDetails}">
                <ContentView.ContentTemplate>
                    <DataTemplate x:DataType="dto:TripDetailDTO">
                        <VerticalStackLayout Spacing="10">

                            <Label Text="{Binding Name}" 
                                   FontSize="Large" 
                                   FontAttributes="Bold" 
                                   HorizontalOptions="Center" />
                            <Label Text="{Binding TripDate, StringFormat='{0:dd.MM.yyyy HH:mm}'}" 
                                   HorizontalOptions="Center" />

                            <maps:Map x:Name="TripMap" 
                                      HeightRequest="300"
                                      MapType="Street"
                                      MoveToLastRegionOnLayoutChange="False"
                                      InitialCameraPosition="{Binding Source={RelativeSource AncestorType={x:Type vm:TripDetailViewModel}}, Path=MapStartRegion}">

                                <maps:Map.MapElements>
                                    <Binding Source="{RelativeSource AncestorType={x:Type vm:TripDetailViewModel}}" 
                                             Path="RoutePolyline" />
                                </maps:Map.MapElements>

                                <maps:Map.Pins>
                                    <Binding Source="{RelativeSource AncestorType={x:Type vm:TripDetailViewModel}}" 
                                             Path="Pins" />
                                </maps:Map.Pins>
                            </maps:Map>

                            <Frame Padding="10" CornerRadius="10" Margin="0,10,0,0">
                                <Grid ColumnDefinitions="*,Auto" RowDefinitions="Auto,Auto,Auto,Auto" Padding="5">
                                    <Label Grid.Row="0" Grid.Column="0" Text="Dystans:" />
                                    <Label Grid.Row="0" Grid.Column="1" Text="{Binding Distance, StringFormat='{0:F2} km'}" FontAttributes="Bold" />

                                    <Label Grid.Row="1" Grid.Column="0" Text="Czas trwania:" />
                                    <Label Grid.Row="1" Grid.Column="1" Text="{Binding Duration, Converter={StaticResource SecondsToHoursConverter}}" FontAttributes="Bold" />

                                    <Label Grid.Row="2" Grid.Column="0" Text="PrzewyÅ¼szenie:" />
                                    <Label Grid.Row="2" Grid.Column="1"Text="{Binding ElevationGain, StringFormat='{0:F0} m'}" FontAttributes="Bold" />

                                    <Label Grid.Row="3" Grid.Column="0" Text="Kroki:" />
                                    <Label Grid.Row="3" Grid.Column="1" Text="{Binding Steps}" FontAttributes="Bold" />
                                </Grid>
                            </Frame>

                        </VerticalStackLayout>
                    </DataTemplate>
                </ContentView.ContentTemplate>
            </ContentView>

        </VerticalStackLayout>
    </ScrollView>
</ContentPage>