<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:DziennikPlecakowy.ViewModels"
             xmlns:dto="clr-namespace:DziennikPlecakowy.DTO;assembly=DziennikPlecakowy.DTO"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="vm:AdminViewModel"
             x:Class="DziennikPlecakowy.Views.AdminPage"
             Shell.NavBarIsVisible="False"
             Shell.TabBarIsVisible="False"
             Style="{StaticResource PageStyle}">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
            EventName="Appearing"
            Command="{Binding LoadUsersCommand}" />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto, Auto, Auto, *">

        <Label Grid.Row="0" Text="Panel Administratora" Style="{StaticResource TitleLabel}" />

        <Button Grid.Row="1" 
                Text="Wróć do Konta"
                Command="{Binding GoBackAsyncCommand}"
                Style="{StaticResource TextButton}"
                HorizontalOptions="Center" />

        <SearchBar Grid.Row="2"
                   Placeholder="Szukaj po emailu lub nazwie..."
                   Text="{Binding SearchText}"
                   Margin="20,10"
                   BackgroundColor="{AppThemeBinding Light={StaticResource LightCardBackground}, Dark={StaticResource DarkCardBackground}}"
                   TextColor="{AppThemeBinding Light={StaticResource LightTextPrimary}, Dark={StaticResource DarkTextPrimary}}"
                   PlaceholderColor="{AppThemeBinding Light={StaticResource LightPlaceholder}, Dark={StaticResource DarkPlaceholder}}" />

        <CollectionView Grid.Row="3"
                        ItemsSource="{Binding Users}">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="dto:AdminUserDetailDTO">

                    <Frame Style="{StaticResource CardFrame}" Margin="20,5" Padding="15">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer
                                Command="{Binding Source={RelativeSource AncestorType={x:Type vm:AdminViewModel}}, Path=ShowUserActionsCommand}"
                                CommandParameter="{Binding .}" />
                        </Frame.GestureRecognizers>

                        <Grid ColumnDefinitions="*, Auto" RowDefinitions="Auto, Auto, Auto">
                            <VerticalStackLayout Grid.Column="0" Grid.Row="0" Grid.RowSpan="3" VerticalOptions="Start">
                                <Label Text="{Binding Username}" Style="{StaticResource StatValueLabel}" HorizontalOptions="Start" />
                                <Label Text="{Binding Email}" Style="{StaticResource StatLabel}" HorizontalOptions="Start" />
                            </VerticalStackLayout>

                            <Label Grid.Column="1" Grid.Row="0" 
                                   Text="ADMIN" FontAttributes="Bold" TextColor="{StaticResource WarningOrange}"
                                   IsVisible="{Binding IsAdmin}" FontSize="Small" />
                            <Label Grid.Column="1" Grid.Row="1" 
                                   Text="ZABLOKOWANY" FontAttributes="Bold" TextColor="{StaticResource DeleteRed}"
                                   IsVisible="{Binding IsLocked}" FontSize="Small" />
                            <Label Grid.Column="1" Grid.Row="2" 
                                   Text="ZMIEŃ HASŁO" FontAttributes="Bold" TextColor="{StaticResource MainBlue}"
                                   IsVisible="{Binding MustChangePassword}" FontSize="Small" />
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <ActivityIndicator Grid.Row="0" Grid.RowSpan="4" IsRunning="{Binding IsBusy}" HorizontalOptions="Center" VerticalOptions="Center" />

    </Grid>
</ContentPage>